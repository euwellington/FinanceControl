@echo off
chcp 65001 >nul
title ๐ FULLSTACK DEPLOY - FINANCE CONTROL
mode con: cols=105 lines=45

set "ESC="
set "CYAN=%ESC%[96m"
set "YELLOW=%ESC%[93m"
set "WHITE=%ESC%[97m"
set "GREEN=%ESC%[92m"
set "RED=%ESC%[91m"
set "MAGENTA=%ESC%[95m"
set "RESET=%ESC%[0m"

:security_check
cls
echo.
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo %YELLOW%  โ  โโโโโโโโโโโโโโโ   โโโ โโโโโโ โโโโ   โโโ โโโโโโโโโโโโโโโ          โ%RESET%
echo %YELLOW%  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ          โ%RESET%
echo %YELLOW%  โ  โโโโโโ  โโโโโโโโโ โโโโโโโโโโโโโโโโโ โโโโโโ     โโโโโโ            โ%RESET%
echo %YELLOW%  โ  โโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโ            โ%RESET%
echo %YELLOW%  โ  โโโ     โโโโโโ โโโโโโโโโ  โโโโโโ โโโโโโโโโโโโโโโโโโโโโโ          โ%RESET%
echo %YELLOW%  โ  โโโ     โโโโโโ  โโโโโโโโ  โโโโโโ  โโโโโ โโโโโโโโโโโโโโโ          โ%RESET%
echo %WHITE%  โ                                                                            โ%RESET%
echo %WHITE%  โ          โโโโโโโ โโโโโโโ โโโโ   โโโโโโโโโโโโโโโโโโโ  โโโโโโโ โโโ           โ%RESET%
echo %WHITE%  โ         โโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ           โ%RESET%
echo %WHITE%  โ         โโโ     โโโ   โโโโโโโโโ โโโ   โโโ   โโโโโโโโโโโ   โโโโโโ           โ%RESET%
echo %WHITE%  โ         โโโ     โโโ   โโโโโโโโโโโโโ   โโโ   โโโโโโโโโโโ   โโโโโโ           โ%RESET%
echo %WHITE%  โ         โโโโโโโโโโโโโโโโโโโโ โโโโโโ   โโโ   โโโ  โโโโโโโโโโโโโโโโโโโโ      โ%RESET%
echo %WHITE%  โ          โโโโโโโ โโโโโโโ โโโ  โโโโโ   โโโ   โโโ  โโโ โโโโโโโ โโโโโโโโ      โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo.
echo %MAGENTA%  [๐ก๏ธ SEGURANรA]: Arquivo verificado. O cรณdigo executa apenas o deploy local.%RESET%
echo %WHITE%  [DICA]: Clique com o botรฃo direito e 'Editar' para analisar o script.%RESET%

echo ======================================================
echo           ๐ก๏ธ FINANCE CONTROL - DEPLOY SYSTEM
echo ======================================================
echo.
echo ESTE ARQUIVO EH 100%% SEGURO.
echo.
echo Este executavel (.bat) foi criado para automatizar:
echo 1. O deploy do Backend via Docker.
echo 2. A instalacao de dependencias do Frontend (NPM).
echo 3. A inicializacao do servidor de desenvolvimento.
echo.
echo ------------------------------------------------------
echo COMO VERIFICAR A SEGURANCA:
echo ------------------------------------------------------
echo Se voce deseja auditar o que o script faz:
echo 1. Clique com o botao direito no arquivo "deploy.bat".
echo 2. Selecione "Abrir com" -^> "Bloco de Notas" (Notepad).
echo 3. Voce vera que sao apenas comandos simples de 
echo    terminal (cd, docker, npm).
echo.
echo Obrigado por utilizar o Finance Control!
echo ======================================================

echo.
set /p "choice=%CYAN%  > Deseja prosseguir com o deploy Fullstack? (S/N): %RESET%"
if /i "%choice%" neq "S" exit

:backend_step
cls
echo.
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo %YELLOW%  โ  โโโโโโโ โโโโโโโโโโโโโโโ โโโ      โโโโโโโ โโโ   โโโ    โโโโโโโ  โโโโโโ  โโโโโโโโโโ  โโโ โ%RESET%
echo %YELLOW%  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโ โโโโ    โโโโโโโโโโโโโโโโโโโโโโโโโโโ โโโโ โ%RESET%
echo %YELLOW%  โ  โโโ  โโโโโโโโโ  โโโโโโโโโโโ     โโโ   โโโ โโโโโโโ     โโโโโโโโโโโโโโโโโโโ     โโโโโโโ  โ%RESET%
echo %YELLOW%  โ  โโโ  โโโโโโโโโ  โโโโโโโ โโโ     โโโ   โโโ  โโโโโ      โโโโโโโโโโโโโโโโโโโ     โโโโโโโ  โ%RESET%
echo %YELLOW%  โ  โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโ   โโโ       โโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโ โ%RESET%
echo %YELLOW%  โ  โโโโโโโ โโโโโโโโโโโ     โโโโโโโโ โโโโโโโ    โโโ       โโโโโโโ โโโ  โโโ โโโโโโโโโโ  โโโ โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ%RESET%
echo %WHITE%  โ                        ๐ DEPLOY BACKEND - DOCKER COMPOSE                              โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo.

set "BACK_PATH=Backend\FinanceControl\FinanceControl.slnx"
set "BACK_DIR=Backend\FinanceControl"

if exist "%BACK_PATH%" (
    cd /d "%~dp0%BACK_DIR%"
    docker-compose --verbose up -d
) else (
    echo %RED% [ERRO]: Backend nรฃo localizado.%RESET%
    pause & exit
)
timeout /t 2 >nul

:frontend_step
cls
echo.
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo %MAGENTA%  โ  โโโโโโโ โโโโโโโโโโโโโโโ โโโ      โโโโโโโ โโโ   โโโ    โโโโโโโโโโโโโโโ  โโโโโโโ โโโโ   โโโ โ%RESET%
echo %MAGENTA%  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโ โโโโ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโ โ%RESET%
echo %MAGENTA%  โ  โโโ  โโโโโโโโโ  โโโโโโโโโโโ     โโโ   โโโ โโโโโโโ     โโโโโโ  โโโโโโโโโโโ   โโโโโโโโโ โโโ โ%RESET%
echo %MAGENTA%  โ  โโโ  โโโโโโโโโ  โโโโโโโ โโโ     โโโ   โโโ  โโโโโ      โโโโโโ  โโโโโโโโโโโ   โโโโโโโโโโโโโ โ%RESET%
echo %MAGENTA%  โ  โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโ   โโโ       โโโ     โโโ  โโโโโโโโโโโโโโโ โโโโโโ โ%RESET%
echo %MAGENTA%  โ  โโโโโโโ โโโโโโโโโโโ     โโโโโโโโ โโโโโโโ    โโโ       โโโ     โโโ  โโโ โโโโโโโ โโโ  โโโโโ โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ%RESET%
echo %WHITE%  โ                        ๐ DEPLOY FRONTEND - NPM E VITE                                 โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo.

set "FRONT_DIR=Frontend\financecontrol"
if exist "%~dp0%FRONT_DIR%" (
    cd /d "%~dp0%FRONT_DIR%"
    call npm i
    start http://localhost:5173
    start /b cmd /c "npm run dev"
) else (
    echo %RED% [ERRO]: Frontend nรฃo localizado.%RESET%
    pause & exit
)
timeout /t 3 >nul

:final
cls
echo.
echo %GREEN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo %GREEN%  โ  โโโโโโโ โโโโโโโโโโโโโโโ โโโ      โโโโโโโ โโโ   โโโ    โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโ  โ%RESET%
echo %GREEN%  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโ โโโโ    โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ  โ%RESET%
echo %GREEN%  โ  โโโ  โโโโโโโโโ  โโโโโโโโโโโ     โโโ   โโโ โโโโโโโ     โโโโโโ  โโโโโโโโโ โโโโโโโโโโโโโโโโโ  โ%RESET%
echo %GREEN%  โ  โโโ  โโโโโโโโโ  โโโโโโโ โโโ     โโโ   โโโ  โโโโโ      โโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ%RESET%
echo %GREEN%  โ  โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโ   โโโ       โโโ     โโโโโโ โโโโโโโโโโโโโโโโโโโโ  โ%RESET%
echo %GREEN%  โ  โโโโโโโ โโโโโโโโโโโ     โโโโโโโโ โโโโโโโ    โโโ       โโโ     โโโโโโ  โโโโโโโโโโโโโโโโโโโ  โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ%RESET%
echo %WHITE%  โ                    โจ TODOS OS SERVIรOS ESTรO EM EXECUรรO! โจ                         โ%RESET%
echo %CYAN%  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ%RESET%
echo.
pause